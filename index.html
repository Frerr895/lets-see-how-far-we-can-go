<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Let's See How Far We Can Go - World Record</title>
    
    <!-- Favicon simple con emoji -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üöÄ</text></svg>">
    
    <!-- Firebase SDK (Compat version for HTML) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3a8a 0%, #1e293b 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .header-banner {
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            text-align: center;
            margin: 0 auto 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            max-width: 1000px;
        }

        .record-badge {
            display: inline-block;
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .header-title {
            font-size: 1.3em;
            color: #333;
            font-weight: 600;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 30px;
            padding: 50px;
            max-width: 1000px;
            margin: 0 auto 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        h1 {
            font-size: 2.8em;
            color: #333;
            margin-bottom: 15px;
            text-align: center;
            line-height: 1.2;
        }

        .subtitle {
            color: #666;
            font-size: 1.2em;
            margin-bottom: 30px;
            text-align: center;
        }

        .user-actions {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 10px 20px;
            background: #1e40af;
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 1em;
        }

        .action-btn:hover {
            background: #1e3a8a;
            transform: translateY(-2px);
        }

        .goal-section {
            background: linear-gradient(135deg, #1e40af 0%, #1e3a8a 100%);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            color: white;
            text-align: center;
        }

        .goal-title {
            font-size: 1.3em;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .progress-bar-container {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50px;
            height: 40px;
            margin-bottom: 15px;
            overflow: hidden;
            position: relative;
        }

        .progress-bar {
            background: linear-gradient(90deg, #16a34a 0%, #15803d 100%);
            height: 100%;
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1em;
        }

        .goal-stats {
            display: flex;
            justify-content: space-around;
            margin-top: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .goal-stat {
            text-align: center;
        }

        .goal-stat-value {
            font-size: 2em;
            font-weight: bold;
        }

        .goal-stat-label {
            font-size: 0.9em;
            opacity: 0.9;
            margin-top: 5px;
        }

        .next-milestone {
            background: rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 15px;
            margin-top: 20px;
            font-size: 1.1em;
        }

        .next-milestone-title {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .counter-section {
            background: linear-gradient(135deg, #475569 0%, #334155 100%);
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            text-align: center;
        }

        .counter-label {
            color: white;
            font-size: 1.2em;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .counter {
            font-size: 4.5em;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            margin-bottom: 10px;
        }

        .donor-count {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.1em;
            margin-top: 10px;
        }

        .today-highlight {
            background: rgba(255, 255, 255, 0.15);
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .today-count {
            font-size: 2.5em;
            font-weight: bold;
            color: #4ade80;
        }

        .today-label {
            color: rgba(255, 255, 255, 0.8);
            margin-top: 5px;
        }

        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            overflow-y: auto;
            padding: 20px;
        }

        .modal.show {
            display: block;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            margin: 50px auto;
            position: relative;
            max-height: calc(100vh - 100px);
            overflow-y: auto;
            /* Hacer el scroll m√°s evidente */
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.3),
                inset 0 -30px 30px -30px rgba(0, 0, 0, 0.1); /* Sombra interna abajo */
        }
        
        /* Indicador de scroll en m√≥vil */
        .modal-content::after {
            content: '‚¨á Scroll down ‚¨á';
            position: sticky;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(255, 255, 255, 0.95), transparent);
            text-align: center;
            padding: 15px 0 10px;
            font-weight: 600;
            color: #1e40af;
            font-size: 0.9em;
            pointer-events: none;
            opacity: 0;
            animation: fadeInOut 2s ease-in-out infinite;
        }
        
        @keyframes fadeInOut {
            0%, 100% { opacity: 0; }
            50% { opacity: 1; }
        }
        
        /* Ocultar indicador cuando se ha scrolleado */
        .modal-content.scrolled::after {
            display: none;
        }
        
        /* Bot√≥n flotante para indicar scroll */
        .scroll-indicator-btn {
            position: sticky;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #1e40af 0%, #1e3a8a 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 8px 20px rgba(30, 64, 175, 0.4);
            z-index: 1000;
            display: none;
            animation: bounce 2s ease-in-out infinite;
            margin-top: 20px;
        }
        
        .scroll-indicator-btn.visible {
            display: inline-block;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateX(-50%) translateY(0); }
            50% { transform: translateX(-50%) translateY(-10px); }
        }
        
        .scroll-indicator-btn:hover {
            background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
            box-shadow: 0 10px 25px rgba(30, 64, 175, 0.5);
        }

        .modal-content.wide {
            max-width: 900px;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 30px;
            cursor: pointer;
            color: #666;
            line-height: 1;
        }

        .modal-close:hover {
            color: #000;
        }

        .modal-title {
            font-size: 2em;
            margin-bottom: 20px;
            color: #1e40af;
            padding-right: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1em;
        }

        .form-input:focus {
            outline: none;
            border-color: #1e40af;
        }

        .optional-badge {
            color: #64748b;
            font-size: 0.85em;
            font-weight: normal;
        }

        .avatar-selector {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-top: 10px;
        }

        .avatar-option {
            padding: 15px;
            border: 3px solid #e2e8f0;
            border-radius: 15px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
            background: white;
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .avatar-option:hover {
            border-color: #1e40af;
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(30, 64, 175, 0.3);
        }

        .avatar-option.selected {
            border-color: #1e40af;
            background: #dbeafe;
            box-shadow: 0 5px 15px rgba(30, 64, 175, 0.4);
        }

        .avatar-option svg {
            width: 100%;
            height: 100%;
            max-width: 80px;
            max-height: 80px;
        }

        /* Currency Selector */
        .currency-selector {
            background: #f8fafc;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .currency-selector-title {
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 15px;
            text-align: center;
            font-size: 1.1em;
        }

        .currency-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 10px;
            max-height: 300px;
            overflow-y: auto;
            padding: 10px;
        }

        .currency-option {
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
            text-align: center;
        }

        .currency-option:hover {
            border-color: #1e40af;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(30, 64, 175, 0.2);
        }

        .currency-option.selected {
            border-color: #1e40af;
            background: #dbeafe;
            box-shadow: 0 4px 12px rgba(30, 64, 175, 0.3);
        }

        .currency-flag {
            font-size: 2em;
            margin-bottom: 5px;
        }

        .currency-code {
            font-weight: 600;
            color: #1e293b;
            font-size: 1em;
        }

        .currency-amount {
            color: #1e40af;
            font-weight: 600;
            font-size: 0.95em;
            margin-top: 3px;
        }

        .currency-name {
            color: #64748b;
            font-size: 0.75em;
            margin-top: 3px;
        }

        .selected-currency-display {
            background: linear-gradient(135deg, #1e40af 0%, #1e3a8a 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
        }

        .selected-currency-display .amount {
            font-size: 2em;
            font-weight: bold;
        }

        .selected-currency-display .equivalent {
            font-size: 0.9em;
            opacity: 0.9;
            margin-top: 5px;
        }

        /* Avatar Customizer */
        .avatar-customizer {
            background: #f8fafc;
            padding: 25px;
            border-radius: 15px;
            margin-top: 20px;
        }

        .avatar-preview {
            width: 150px;
            height: 150px;
            margin: 0 auto 20px;
            border: 3px solid #1e40af;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
        }

        .avatar-preview svg {
            width: 120px;
            height: 120px;
        }

        .customizer-section {
            margin-bottom: 20px;
        }

        .customizer-label {
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 10px;
            display: block;
        }

        .color-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 10px;
        }

        .color-option {
            width: 100%;
            aspect-ratio: 1;
            border-radius: 8px;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .color-option:hover {
            transform: scale(1.1);
        }

        .color-option.selected {
            border-color: #1e293b;
            box-shadow: 0 0 0 2px white, 0 0 0 4px #1e293b;
        }

        .checkbox-group {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            margin-bottom: 15px;
        }

        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            margin-top: 2px;
        }

        .checkbox-group label {
            cursor: pointer;
            color: #333;
        }

        .submit-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #16a34a 0%, #15803d 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(22, 163, 74, 0.4);
        }

        .ranking-section {
            background: #f8fafc;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .ranking-title {
            font-size: 1.8em;
            color: #1e40af;
            margin-bottom: 20px;
            text-align: center;
        }

        .view-full-ranking {
            text-align: center;
            margin-top: 20px;
        }

        .view-full-ranking button {
            padding: 12px 30px;
            background: #1e40af;
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .view-full-ranking button:hover {
            background: #1e3a8a;
            transform: translateY(-2px);
        }

        .ranking-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .ranking-item.user-highlight {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            border: 2px solid #1e40af;
        }

        .ranking-position {
            font-size: 1.5em;
            font-weight: bold;
            color: #64748b;
            min-width: 60px;
            text-align: center;
        }

        .ranking-position.top1 { 
            color: #fbbf24;
            text-shadow: 0 0 10px rgba(251, 191, 36, 0.5);
        }
        .ranking-position.top2 { 
            color: #94a3b8;
            text-shadow: 0 0 10px rgba(148, 163, 184, 0.5);
        }
        .ranking-position.top3 { 
            color: #d97706;
            text-shadow: 0 0 10px rgba(217, 119, 6, 0.5);
        }

        .ranking-avatar {
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .ranking-avatar svg {
            width: 100%;
            height: 100%;
        }

        .ranking-info {
            flex: 1;
        }

        .ranking-name {
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 3px;
        }

        .ranking-stats {
            color: #64748b;
            font-size: 0.9em;
        }

        .ranking-amount {
            font-size: 1.3em;
            font-weight: bold;
            color: #1e40af;
            text-align: right;
        }

        .ranking-achievements {
            display: flex;
            gap: 5px;
            margin-top: 8px;
            flex-wrap: wrap;
        }

        .ranking-achievements .achievement-badge {
            width: 30px;
            height: 30px;
        }

        .user-profile {
            background: linear-gradient(135deg, #1e40af 0%, #1e3a8a 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            text-align: center;
        }

        .user-avatar-large {
            width: 120px;
            height: 120px;
            margin: 0 auto 20px;
        }

        .user-avatar-large svg {
            width: 100%;
            height: 100%;
            filter: drop-shadow(0 10px 20px rgba(0, 0, 0, 0.3));
        }

        .user-name {
            font-size: 1.5em;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .user-email {
            opacity: 0.9;
            font-size: 0.9em;
            margin-bottom: 20px;
        }

        .user-stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .user-stat-box {
            background: rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 10px;
        }

        .user-stat-value {
            font-size: 2em;
            font-weight: bold;
        }

        .user-stat-label {
            font-size: 0.9em;
            opacity: 0.9;
            margin-top: 5px;
        }

        .user-ranking-position {
            background: rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            font-size: 1.2em;
        }

        .achievements-section {
            margin-top: 25px;
        }

        .achievements-title {
            font-size: 1.5em;
            color: #1e40af;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .achievement-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }

        .achievement-item.unlocked {
            background: linear-gradient(135deg, #fff7ed 0%, #fed7aa 100%);
            box-shadow: 0 4px 15px rgba(251, 146, 60, 0.3);
        }

        .achievement-item.locked {
            opacity: 0.5;
            background: #f8fafc;
        }

        .achievement-icon {
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .achievement-icon svg {
            width: 100%;
            height: 100%;
        }

        .achievement-info {
            flex: 1;
        }

        .achievement-name {
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 3px;
            font-size: 1.1em;
        }

        .achievement-desc {
            color: #64748b;
            font-size: 0.9em;
        }

        .achievement-progress {
            background: #e2e8f0;
            height: 8px;
            border-radius: 4px;
            margin-top: 8px;
            overflow: hidden;
        }

        .achievement-progress-bar {
            background: linear-gradient(90deg, #16a34a 0%, #15803d 100%);
            height: 100%;
            transition: width 0.5s ease;
        }

        .share-section {
            text-align: center;
            margin: 30px 0;
            padding: 25px;
            background: #f1f5f9;
            border-radius: 20px;
        }

        .share-title {
            font-size: 1.3em;
            color: #1e293b;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .share-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .share-btn {
            padding: 12px 25px;
            border-radius: 25px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .share-btn:hover {
            transform: translateY(-2px);
        }

        .share-twitter {
            background: #1DA1F2;
            color: white;
        }

        .share-facebook {
            background: #1877F2;
            color: white;
        }

        .share-whatsapp {
            background: #25D366;
            color: white;
        }

        .share-copy {
            background: #64748b;
            color: white;
        }

        .message {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 2000;
            padding: 20px 40px;
            background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%);
            border-radius: 15px;
            color: #14532d;
            font-size: 1.1em;
            opacity: 0;
            transition: all 0.3s ease;
            text-align: center;
            font-weight: 600;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            max-width: 90%;
            border: 2px solid #16a34a;
        }

        .message.show {
            opacity: 1;
            top: 30px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 30px;
            padding-top: 30px;
            border-top: 2px solid #eee;
        }

        .stat {
            text-align: center;
            padding: 20px;
            background: #f8fafc;
            border-radius: 15px;
        }

        .stat-value {
            font-size: 2.2em;
            font-weight: bold;
            color: #1e40af;
        }

        .stat-label {
            color: #666;
            font-size: 0.95em;
            margin-top: 8px;
        }

        .why-donate-section {
            background: #dbeafe;
            border-left: 4px solid #1e40af;
            padding: 25px;
            border-radius: 10px;
            margin-top: 30px;
        }

        .why-donate-section h3 {
            color: #1e3a8a;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .why-donate-section ul {
            list-style: none;
            padding: 0;
        }

        .why-donate-section li {
            color: #1e40af;
            line-height: 1.8;
            padding-left: 25px;
            position: relative;
            margin-bottom: 10px;
        }

        .why-donate-section li:before {
            content: "‚úì";
            position: absolute;
            left: 0;
            font-weight: bold;
            color: #16a34a;
        }

        .info-section {
            background: #f1f5f9;
            border-left: 4px solid #64748b;
            padding: 20px;
            border-radius: 10px;
            margin-top: 30px;
        }

        .info-section h3 {
            color: #1e293b;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .info-section p {
            color: #475569;
            line-height: 1.6;
        }

        .milestone {
            background: #dbeafe;
            padding: 15px 20px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: center;
            font-weight: 600;
            color: #1e40af;
            display: none;
        }

        .milestone.show {
            display: block;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }

        .pulse {
            animation: pulse 0.5s ease;
        }

        @media (max-width: 600px) {
            .container {
                padding: 30px 20px;
            }
            
            h1 {
                font-size: 2em;
            }
            
            .counter {
                font-size: 3em;
            }

            .modal-content {
                padding: 25px;
                margin: 20px auto;
            }

            .avatar-selector {
                grid-template-columns: repeat(3, 1fr);
            }

            .user-stats-grid {
                grid-template-columns: 1fr;
            }

            .color-grid {
                grid-template-columns: repeat(6, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- Mensaje de notificaci√≥n flotante -->
    <div class="message" id="message"></div>

    <div class="header-banner">
        <div class="record-badge">WORLD RECORD ATTEMPT</div>
        <div class="header-title">Highest Number of ‚Ç¨1 Donations</div>
    </div>

    <div class="container">
        <h1>Let's See How Far We Can Go</h1>
        <p class="subtitle">Join a global-scale experiment. Just ‚Ç¨1 per donation.</p>
        
        <div class="user-actions">
            <button class="action-btn" id="btnDonate">üí∞ Donate ‚Ç¨1</button>
            <button class="action-btn" id="btnProfile">üë§ My Profile</button>
            <button class="action-btn" id="btnRanking">üèÜ Full Ranking</button>
        </div>

        <div class="goal-section">
            <div class="goal-title">GOAL: 1,000,000 DONATIONS</div>
            <div class="progress-bar-container">
                <div class="progress-bar" id="progressBar">0%</div>
            </div>
            <div class="goal-stats">
                <div class="goal-stat">
                    <div class="goal-stat-value" id="currentDonors">0</div>
                    <div class="goal-stat-label">Current donations</div>
                </div>
                <div class="goal-stat">
                    <div class="goal-stat-value" id="remaining">1,000,000</div>
                    <div class="goal-stat-label">Remaining</div>
                </div>
                <div class="goal-stat">
                    <div class="goal-stat-value" id="percentage">0%</div>
                    <div class="goal-stat-label">Completed</div>
                </div>
            </div>
            <div class="next-milestone" id="nextMilestone">
                <div class="next-milestone-title">Next milestone:</div>
                <div>100 donations</div>
            </div>
        </div>

        <div class="counter-section">
            <div class="counter-label">Total raised</div>
            <div class="counter" id="counter">0 ‚Ç¨</div>
            <div class="donor-count" id="donorCount">0 donations made</div>
            <div class="today-highlight">
                <div class="today-count" id="todayCount">0</div>
                <div class="today-label">Donations today</div>
            </div>
        </div>

        <div class="milestone" id="milestone"></div>

        <div class="ranking-section">
            <h2 class="ranking-title">üèÜ TOP 5 DONORS</h2>
            <div id="rankingListTop5">
                <p style="text-align: center; color: #64748b;">No donations yet. Be the first!</p>
            </div>
            <div class="view-full-ranking">
                <button id="btnViewFullRanking">View Full Ranking</button>
            </div>
        </div>

        <div class="share-section">
            <div class="share-title">Share this experiment</div>
            <div class="share-buttons">
                <button class="share-btn share-twitter" id="btnShareTwitter">üê¶ Twitter</button>
                <button class="share-btn share-facebook" id="btnShareFacebook">üìò Facebook</button>
                <button class="share-btn share-whatsapp" id="btnShareWhatsApp">üí¨ WhatsApp</button>
                <button class="share-btn share-copy" id="btnCopyLink">üîó Copy link</button>
            </div>
        </div>

        <div class="why-donate-section">
            <h3>Why donate?</h3>
            <ul>
                <li>Be part of a unique global-scale social experiment</li>
                <li>Just ‚Ç¨1 - accessible to anyone</li>
                <li>Help establish a verifiable world record</li>
                <li>Unlock achievements and compete in the ranking</li>
                <li>Be part of internet history</li>
            </ul>
        </div>

        <div class="stats-grid">
            <div class="stat">
                <div class="stat-value" id="todayDonations">0</div>
                <div class="stat-label">Today</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="thisWeek">0</div>
                <div class="stat-label">This week</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="avgPerHour">0</div>
                <div class="stat-label">Per hour</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="daysActive">1</div>
                <div class="stat-label">Days active</div>
            </div>
        </div>

        <div class="info-section">
            <h3>About this record</h3>
            <p>We're attempting to set the record for the <strong>highest number of ‚Ç¨1 donations</strong>. Each donation brings us closer to history. Will you help us reach 1,000,000 donations?</p>
        </div>
    </div>

    <!-- Donation Modal -->
    <div class="modal" id="donateModal">
        <div class="modal-content">
            <span class="modal-close" id="closeDonate">&times;</span>
            <h2 class="modal-title">Donate the equivalent of ‚Ç¨1</h2>
            
            <!-- Selector de moneda -->
            <div class="currency-selector">
                <div class="currency-selector-title">Select your currency</div>
                <div class="selected-currency-display" id="selectedCurrencyDisplay">
                    <div class="amount"><span id="selectedCurrencySymbol">‚Ç¨</span><span id="selectedCurrencyAmount">1.00</span></div>
                    <div class="equivalent">‚âà 1.00 EUR</div>
                </div>
                <div class="currency-grid" id="currencyGrid"></div>
            </div>
            
            <!-- Bot√≥n indicador de scroll -->
            <button class="scroll-indicator-btn" id="scrollIndicatorBtn" type="button">
                ‚¨á Scroll down to continue ‚¨á
            </button>
            
            <div id="donationForm">
                <div class="form-group">
                    <label class="form-label">Email <span class="optional-badge">(optional, recommended)</span></label>
                    <input type="email" class="form-input" id="donorEmail" placeholder="your@email.com">
                    <small style="color: #64748b; display: block; margin-top: 5px;">To save your achievements and access them from any device</small>
                </div>

                <div class="form-group">
                    <label class="form-label">Name/Nickname <span class="optional-badge">(optional)</span></label>
                    <input type="text" class="form-input" id="donorName" placeholder="How do you want to appear?">
                    <small style="color: #64748b; display: block; margin-top: 5px;">If you don't enter anything, you'll appear as "Anonymous Donor"</small>
                </div>

                <div class="form-group">
                    <label class="form-label">Customize your avatar</label>
                    <div class="avatar-customizer">
                        <div class="avatar-preview" id="avatarPreview"></div>
                        
                        <div class="customizer-section">
                            <label class="customizer-label">Background color</label>
                            <div class="color-grid" id="bgColorGrid"></div>
                        </div>
                        
                        <div class="customizer-section">
                            <label class="customizer-label">Accent color</label>
                            <div class="color-grid" id="accentColorGrid"></div>
                        </div>
                        
                        <div class="customizer-section">
                            <label class="customizer-label">Avatar style</label>
                            <div class="avatar-selector" id="avatarStyleSelector"></div>
                        </div>
                    </div>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="showInRanking" checked>
                    <label for="showInRanking">Appear in public ranking</label>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="saveAchievements" checked>
                    <label for="saveAchievements">Save my achievements (requires email)</label>
                </div>
            </div>

            <button class="submit-btn" id="btnProcessDonation">Confirm Donation</button>
            <p style="text-align: center; color: #64748b; margin-top: 15px; font-size: 0.9em;">This is a demo version. In the final version, real payments will be processed.</p>
        </div>
    </div>

    <!-- Edit Profile Modal -->
    <div class="modal" id="editProfileModal">
        <div class="modal-content">
            <span class="modal-close" id="closeEditProfile">&times;</span>
            <h2 class="modal-title">‚öôÔ∏è Edit My Profile</h2>
            
            <div class="form-group">
                <label class="form-label">Email</label>
                <input type="email" class="form-input" id="editEmail" placeholder="your@email.com">
            </div>

            <div class="form-group">
                <label class="form-label">Name/Nickname</label>
                <input type="text" class="form-input" id="editName" placeholder="How do you want to appear?">
            </div>

            <div class="form-group">
                <label class="form-label">Customize your avatar</label>
                <div class="avatar-customizer">
                    <div class="avatar-preview" id="avatarPreviewEdit"></div>
                    
                    <div class="customizer-section">
                        <label class="customizer-label">Background color</label>
                        <div class="color-grid" id="bgColorGridEdit"></div>
                    </div>
                    
                    <div class="customizer-section">
                        <label class="customizer-label">Accent color</label>
                        <div class="color-grid" id="accentColorGridEdit"></div>
                    </div>
                    
                    <div class="customizer-section">
                        <label class="customizer-label">Avatar style</label>
                        <div class="avatar-selector" id="avatarStyleSelectorEdit"></div>
                    </div>
                </div>
            </div>

            <div class="checkbox-group">
                <input type="checkbox" id="editShowInRanking">
                <label for="editShowInRanking">Appear in public ranking</label>
            </div>

            <button class="submit-btn" id="btnSaveProfile">üíæ Save Changes</button>
        </div>
    </div>

    <!-- Profile Modal -->
    <div class="modal" id="profileModal">
        <div class="modal-content">
            <span class="modal-close" id="closeProfile">&times;</span>
            <h2 class="modal-title">My Profile</h2>
            <div id="profileContent"></div>
        </div>
    </div>

    <!-- Full Ranking Modal -->
    <div class="modal" id="fullRankingModal">
        <div class="modal-content wide">
            <span class="modal-close" id="closeFullRanking">&times;</span>
            <h2 class="modal-title">üèÜ Full Rankings</h2>
            <div id="fullRankingContent"></div>
        </div>
    </div>

    <script>
        // ==================== FIREBASE CONFIGURATION ====================
        const firebaseConfig = {
            apiKey: "AIzaSyBIPYXBWUkA3CWWYaYOf05Om1d1S7SE4Iw",
            authDomain: "let-s-see-how-far.firebaseapp.com",
            projectId: "let-s-see-how-far",
            storageBucket: "let-s-see-how-far.firebasestorage.app",
            messagingSenderId: "517080353418",
            appId: "1:517080353418:web:a5528e2a74561220a87b73"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();
        
        // Firestore collections
        const donationsRef = db.collection('donations');
        const usersRef = db.collection('users');
        
        console.log('üî• Firebase initialized successfully!');
        
        // Estado de verificaci√≥n de email
        let verificationEmailSent = false;
        
        // Listener de cambios de autenticaci√≥n
        auth.onAuthStateChanged(async (user) => {
            if (user) {
                console.log('üë§ User authenticated:', user.email, 'Verified:', user.emailVerified);
                
                // SOLO marcar como verificado si Firebase dice que lo est√°
                if (user.emailVerified && userData.email === user.email && !userData.emailVerified) {
                    console.log('‚úÖ Email verification detected!');
                    userData.emailVerified = true;
                    localStorage.setItem('userData', JSON.stringify(userData));
                    
                    // Actualizar TODAS las donaciones del usuario en Firebase
                    try {
                        const snapshot = await donationsRef.where('email', '==', user.email).get();
                        const batch = db.batch();
                        
                        snapshot.docs.forEach(doc => {
                            batch.update(doc.ref, { emailVerified: true });
                        });
                        
                        await batch.commit();
                        
                        // Actualizar usuario
                        await usersRef.doc(user.email).update({
                            emailVerified: true,
                            verifiedAt: new Date().toISOString()
                        });
                        
                        showMessage('‚úÖ Email verified successfully!');
                        
                        // Recargar UI para mostrar badge
                        setTimeout(() => {
                            loadData();
                        }, 1000);
                    } catch (error) {
                        console.error('Error updating verification:', error);
                    }
                }
            }
        });
        // ================================================================

        const GOAL = 1000000;
        
        // Sistema de monedas (equivalentes a 1‚Ç¨)
        const CURRENCIES = [
            { code: 'EUR', symbol: '‚Ç¨', name: 'Euro', amount: 1.00, flag: 'üá™üá∫' },
            { code: 'USD', symbol: '$', name: 'D√≥lar Estadounidense', amount: 1.10, flag: 'üá∫üá∏' },
            { code: 'GBP', symbol: '¬£', name: 'Libra Esterlina', amount: 0.85, flag: 'üá¨üáß' },
            { code: 'JPY', symbol: '¬•', name: 'Yen Japon√©s', amount: 165, flag: 'üáØüáµ' },
            { code: 'CNY', symbol: '¬•', name: 'Yuan Chino', amount: 7.85, flag: 'üá®üá≥' },
            { code: 'CAD', symbol: 'C$', name: 'D√≥lar Canadiense', amount: 1.50, flag: 'üá®üá¶' },
            { code: 'AUD', symbol: 'A$', name: 'D√≥lar Australiano', amount: 1.65, flag: 'üá¶üá∫' },
            { code: 'CHF', symbol: 'CHF', name: 'Franco Suizo', amount: 0.95, flag: 'üá®üá≠' },
            { code: 'MXN', symbol: '$', name: 'Peso Mexicano', amount: 21.50, flag: 'üá≤üáΩ' },
            { code: 'BRL', symbol: 'R$', name: 'Real Brasile√±o', amount: 5.50, flag: 'üáßüá∑' },
            { code: 'ARS', symbol: '$', name: 'Peso Argentino', amount: 1100, flag: 'üá¶üá∑' },
            { code: 'CLP', symbol: '$', name: 'Peso Chileno', amount: 1050, flag: 'üá®üá±' },
            { code: 'COP', symbol: '$', name: 'Peso Colombiano', amount: 4600, flag: 'üá®üá¥' },
            { code: 'INR', symbol: '‚Çπ', name: 'Rupia India', amount: 92, flag: 'üáÆüá≥' },
            { code: 'KRW', symbol: '‚Ç©', name: 'Won Surcoreano', amount: 1450, flag: 'üá∞üá∑' },
            { code: 'RUB', symbol: '‚ÇΩ', name: 'Rublo Ruso', amount: 100, flag: 'üá∑üá∫' },
            { code: 'TRY', symbol: '‚Ç∫', name: 'Lira Turca', amount: 38, flag: 'üáπüá∑' },
            { code: 'ZAR', symbol: 'R', name: 'Rand Sudafricano', amount: 20, flag: 'üáøüá¶' },
            { code: 'SEK', symbol: 'kr', name: 'Corona Sueca', amount: 11.50, flag: 'üá∏üá™' },
            { code: 'NOK', symbol: 'kr', name: 'Corona Noruega', amount: 11.80, flag: 'üá≥üá¥' },
            { code: 'DKK', symbol: 'kr', name: 'Corona Danesa', amount: 7.45, flag: 'üá©üá∞' },
            { code: 'PLN', symbol: 'z≈Ç', name: 'Zloty Polaco', amount: 4.35, flag: 'üáµüá±' },
            { code: 'THB', symbol: '‡∏ø', name: 'Baht Tailand√©s', amount: 38, flag: 'üáπüá≠' },
            { code: 'MYR', symbol: 'RM', name: 'Ringgit Malayo', amount: 4.90, flag: 'üá≤üáæ' },
            { code: 'SGD', symbol: 'S$', name: 'D√≥lar de Singapur', amount: 1.45, flag: 'üá∏üá¨' },
            { code: 'HKD', symbol: 'HK$', name: 'D√≥lar de Hong Kong', amount: 8.55, flag: 'üá≠üá∞' },
            { code: 'NZD', symbol: 'NZ$', name: 'D√≥lar Neozeland√©s', amount: 1.85, flag: 'üá≥üáø' },
            { code: 'PHP', symbol: '‚Ç±', name: 'Peso Filipino', amount: 62, flag: 'üáµüá≠' },
            { code: 'IDR', symbol: 'Rp', name: 'Rupia Indonesia', amount: 17500, flag: 'üáÆüá©' },
            { code: 'SAR', symbol: 'SR', name: 'Riyal Saud√≠', amount: 4.10, flag: 'üá∏üá¶' },
            { code: 'AED', symbol: 'ÿØ.ÿ•', name: 'Dirham de EAU', amount: 4.00, flag: 'üá¶üá™' },
            { code: 'ILS', symbol: '‚Ç™', name: 'Shekel Israel√≠', amount: 3.90, flag: 'üáÆüá±' },
            { code: 'EGP', symbol: 'E¬£', name: 'Libra Egipcia', amount: 55, flag: 'üá™üá¨' },
            { code: 'NGN', symbol: '‚Ç¶', name: 'Naira Nigeriana', amount: 1700, flag: 'üá≥üá¨' },
            { code: 'KES', symbol: 'KSh', name: 'Chel√≠n Keniano', amount: 140, flag: 'üá∞üá™' }
        ];
        
        let selectedCurrency = CURRENCIES[0]; // EUR por defecto
        
        // Estilos de avatares base
        const AVATAR_STYLES = [
            {
                id: 'circle',
                name: 'Circle',
                generate: (bg, accent) => `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="50" cy="50" r="45" fill="${bg}"/>
                    <circle cx="35" cy="40" r="5" fill="${accent}"/>
                    <circle cx="65" cy="40" r="5" fill="${accent}"/>
                    <path d="M 35 60 Q 50 70 65 60" stroke="${accent}" stroke-width="3" fill="none"/>
                </svg>`
            },
            {
                id: 'square',
                name: 'Square',
                generate: (bg, accent) => `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <rect x="10" y="10" width="80" height="80" rx="10" fill="${bg}"/>
                    <circle cx="35" cy="40" r="5" fill="${accent}"/>
                    <circle cx="65" cy="40" r="5" fill="${accent}"/>
                    <rect x="35" y="58" width="30" height="4" fill="${accent}"/>
                </svg>`
            },
            {
                id: 'star',
                name: 'Star',
                generate: (bg, accent) => `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <path d="M 50 10 L 61 40 L 95 45 L 70 67 L 78 95 L 50 80 L 22 95 L 30 67 L 5 45 L 39 40 Z" fill="${bg}"/>
                    <circle cx="42" cy="48" r="4" fill="${accent}"/>
                    <circle cx="58" cy="48" r="4" fill="${accent}"/>
                    <path d="M 42 62 Q 50 68 58 62" stroke="${accent}" stroke-width="2" fill="none"/>
                </svg>`
            },
            {
                id: 'heart',
                name: 'Heart',
                generate: (bg, accent) => `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <path d="M 50 85 C 50 85 15 60 15 35 C 15 20 25 10 35 10 C 42 10 47 15 50 20 C 53 15 58 10 65 10 C 75 10 85 20 85 35 C 85 60 50 85 50 85 Z" fill="${bg}"/>
                    <circle cx="38" cy="38" r="4" fill="${accent}"/>
                    <circle cx="62" cy="38" r="4" fill="${accent}"/>
                    <path d="M 40 52 Q 50 58 60 52" stroke="${accent}" stroke-width="2" fill="none"/>
                </svg>`
            },
            {
                id: 'hexagon',
                name: 'Hexagon',
                generate: (bg, accent) => `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <path d="M 50 5 L 90 27.5 L 90 72.5 L 50 95 L 10 72.5 L 10 27.5 Z" fill="${bg}"/>
                    <circle cx="38" cy="42" r="4" fill="${accent}"/>
                    <circle cx="62" cy="42" r="4" fill="${accent}"/>
                    <path d="M 38 60 Q 50 68 62 60" stroke="${accent}" stroke-width="3" fill="none"/>
                </svg>`
            },
            {
                id: 'diamond',
                name: 'Diamond',
                generate: (bg, accent) => `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <path d="M 50 10 L 90 50 L 50 90 L 10 50 Z" fill="${bg}"/>
                    <circle cx="38" cy="45" r="4" fill="${accent}"/>
                    <circle cx="62" cy="45" r="4" fill="${accent}"/>
                    <path d="M 38 60 Q 50 68 62 60" stroke="${accent}" stroke-width="2" fill="none"/>
                </svg>`
            },
            {
                id: 'robot',
                name: 'Robot',
                generate: (bg, accent) => `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <rect x="20" y="30" width="60" height="50" rx="5" fill="${bg}"/>
                    <circle cx="50" cy="20" r="5" fill="${accent}"/>
                    <line x1="50" y1="20" x2="50" y2="30" stroke="${accent}" stroke-width="2"/>
                    <rect x="30" y="42" width="15" height="15" fill="${accent}"/>
                    <rect x="55" y="42" width="15" height="15" fill="${accent}"/>
                    <rect x="35" y="65" width="30" height="5" fill="${accent}"/>
                    <rect x="15" y="45" width="5" height="15" fill="${bg}"/>
                    <rect x="80" y="45" width="5" height="15" fill="${bg}"/>
                </svg>`
            },
            {
                id: 'alien',
                name: 'Alien',
                generate: (bg, accent) => `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <ellipse cx="50" cy="55" rx="35" ry="40" fill="${bg}"/>
                    <ellipse cx="38" cy="48" rx="8" ry="12" fill="${accent}"/>
                    <ellipse cx="62" cy="48" rx="8" ry="12" fill="${accent}"/>
                    <circle cx="42" cy="25" r="4" fill="${bg}"/>
                    <circle cx="58" cy="25" r="4" fill="${bg}"/>
                    <line x1="42" y1="25" x2="42" y2="35" stroke="${bg}" stroke-width="3"/>
                    <line x1="58" y1="25" x2="58" y2="35" stroke="${bg}" stroke-width="3"/>
                </svg>`
            }
        ];
        
        // Paleta de colores
        const COLORS = {
            backgrounds: [
                '#3b82f6', '#8b5cf6', '#ec4899', '#f59e0b', '#10b981',
                '#06b6d4', '#6366f1', '#14b8a6', '#f97316', '#84cc16',
                '#a855f7', '#0ea5e9', '#22c55e', '#eab308', '#ef4444',
                '#64748b'
            ],
            accents: [
                '#1e40af', '#6d28d9', '#be185d', '#d97706', '#059669',
                '#0891b2', '#4338ca', '#0f766e', '#ea580c', '#65a30d',
                '#7c3aed', '#0369a1', '#16a34a', '#ca8a04', '#dc2626',
                '#475569'
            ]
        };
        
        // Sistema de logros
        const achievements = [
            { 
                id: 'first', 
                name: 'First Donation', 
                desc: 'You made your first contribution', 
                svg: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="50" cy="50" r="45" fill="#fbbf24" stroke="#f59e0b" stroke-width="3"/>
                    <path d="M 50 20 L 55 40 L 75 45 L 58 60 L 62 80 L 50 70 L 38 80 L 42 60 L 25 45 L 45 40 Z" fill="#fff" opacity="0.9"/>
                    <text x="50" y="58" font-size="24" font-weight="bold" fill="#f59e0b" text-anchor="middle">1</text>
                </svg>`,
                required: 1, 
                type: 'donations',
                tier: 'bronze'
            },
            { 
                id: 'generous', 
                name: 'Generous', 
                desc: 'You donated 5 times', 
                svg: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="50" cy="50" r="45" fill="#94a3b8" stroke="#64748b" stroke-width="3"/>
                    <path d="M 50 20 L 55 40 L 75 45 L 58 60 L 62 80 L 50 70 L 38 80 L 42 60 L 25 45 L 45 40 Z" fill="#fff" opacity="0.9"/>
                    <text x="50" y="58" font-size="24" font-weight="bold" fill="#475569" text-anchor="middle">5</text>
                </svg>`,
                required: 5, 
                type: 'donations',
                tier: 'silver'
            },
            { 
                id: 'benefactor', 
                name: 'Benefactor', 
                desc: 'You contributed 10 times to the goal', 
                svg: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="50" cy="50" r="45" fill="#fbbf24" stroke="#f59e0b" stroke-width="3"/>
                    <path d="M 50 15 L 56 38 L 80 43 L 60 62 L 65 85 L 50 73 L 35 85 L 40 62 L 20 43 L 44 38 Z" fill="#fff"/>
                    <circle cx="50" cy="50" r="20" fill="#f59e0b" opacity="0.3"/>
                    <text x="50" y="60" font-size="20" font-weight="bold" fill="#fff" text-anchor="middle">10</text>
                </svg>`,
                required: 10, 
                type: 'donations',
                tier: 'gold'
            },
            { 
                id: 'hero', 
                name: 'Hero', 
                desc: '50 donations - Extraordinary support', 
                svg: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <radialGradient id="heroGrad">
                            <stop offset="0%" style="stop-color:#a855f7;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#7c3aed;stop-opacity:1" />
                        </radialGradient>
                    </defs>
                    <circle cx="50" cy="50" r="45" fill="url(#heroGrad)" stroke="#6d28d9" stroke-width="3"/>
                    <path d="M 50 15 L 56 38 L 80 43 L 60 62 L 65 85 L 50 73 L 35 85 L 40 62 L 20 43 L 44 38 Z" fill="#fff"/>
                    <path d="M 50 25 L 54 40 L 70 43 L 58 54 L 61 70 L 50 63 L 39 70 L 42 54 L 30 43 L 46 40 Z" fill="#fbbf24"/>
                    <text x="50" y="60" font-size="18" font-weight="bold" fill="#fff" text-anchor="middle">50</text>
                </svg>`,
                required: 50, 
                type: 'donations',
                tier: 'epic'
            },
            { 
                id: 'legend', 
                name: 'Legend', 
                desc: '100 donations - Legendary contributor', 
                svg: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <radialGradient id="legendGrad">
                            <stop offset="0%" style="stop-color:#fbbf24;stop-opacity:1" />
                            <stop offset="50%" style="stop-color:#f59e0b;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#dc2626;stop-opacity:1" />
                        </radialGradient>
                    </defs>
                    <circle cx="50" cy="50" r="45" fill="url(#legendGrad)" stroke="#991b1b" stroke-width="3"/>
                    <circle cx="50" cy="50" r="40" fill="none" stroke="#fff" stroke-width="2" opacity="0.5"/>
                    <path d="M 50 10 L 57 35 L 85 40 L 62 60 L 68 88 L 50 75 L 32 88 L 38 60 L 15 40 L 43 35 Z" fill="#fff"/>
                    <circle cx="50" cy="50" r="18" fill="#dc2626"/>
                    <text x="50" y="58" font-size="14" font-weight="bold" fill="#fff" text-anchor="middle">100</text>
                </svg>`,
                required: 100, 
                type: 'donations',
                tier: 'legendary'
            },
            { 
                id: 'spreader', 
                name: 'Spreader', 
                desc: 'You shared the project', 
                svg: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="50" cy="50" r="45" fill="#3b82f6" stroke="#1e40af" stroke-width="3"/>
                    <circle cx="50" cy="35" r="12" fill="#fff"/>
                    <circle cx="30" cy="60" r="10" fill="#fff"/>
                    <circle cx="70" cy="60" r="10" fill="#fff"/>
                    <line x1="42" y1="42" x2="35" y2="52" stroke="#fff" stroke-width="4"/>
                    <line x1="58" y1="42" x2="65" y2="52" stroke="#fff" stroke-width="4"/>
                </svg>`,
                required: 1, 
                type: 'shares',
                tier: 'bronze'
            },
            { 
                id: 'promoter', 
                name: 'Promoter', 
                desc: 'Shared 5 times', 
                svg: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="50" cy="50" r="45" fill="#06b6d4" stroke="#0891b2" stroke-width="3"/>
                    <circle cx="50" cy="30" r="10" fill="#fff"/>
                    <circle cx="30" cy="55" r="8" fill="#fff"/>
                    <circle cx="70" cy="55" r="8" fill="#fff"/>
                    <circle cx="35" cy="75" r="6" fill="#fff"/>
                    <circle cx="65" cy="75" r="6" fill="#fff"/>
                    <path d="M 44 36 L 34 50" stroke="#fff" stroke-width="3"/>
                    <path d="M 56 36 L 66 50" stroke="#fff" stroke-width="3"/>
                    <path d="M 32 62 L 38 70" stroke="#fff" stroke-width="3"/>
                    <path d="M 68 62 L 62 70" stroke="#fff" stroke-width="3"/>
                </svg>`,
                required: 5, 
                type: 'shares',
                tier: 'silver'
            },
            { 
                id: 'ambassador', 
                name: 'Ambassador', 
                desc: 'Shared 10 times - Active spreader', 
                svg: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <radialGradient id="ambassadorGrad">
                            <stop offset="0%" style="stop-color:#10b981;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#059669;stop-opacity:1" />
                        </radialGradient>
                    </defs>
                    <circle cx="50" cy="50" r="45" fill="url(#ambassadorGrad)" stroke="#047857" stroke-width="3"/>
                    <path d="M 50 20 Q 30 40 30 50 Q 30 70 50 85 Q 70 70 70 50 Q 70 40 50 20" fill="#fff"/>
                    <circle cx="50" cy="35" r="8" fill="#10b981"/>
                    <circle cx="35" cy="50" r="6" fill="#10b981"/>
                    <circle cx="65" cy="50" r="6" fill="#10b981"/>
                    <circle cx="42" cy="65" r="5" fill="#10b981"/>
                    <circle cx="58" cy="65" r="5" fill="#10b981"/>
                </svg>`,
                required: 10, 
                type: 'shares',
                tier: 'gold'
            },
            { 
                id: 'viral', 
                name: 'Viral', 
                desc: 'Shared 50 times - Project influencer', 
                svg: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <radialGradient id="viralGrad">
                            <stop offset="0%" style="stop-color:#ec4899;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#be185d;stop-opacity:1" />
                        </radialGradient>
                    </defs>
                    <circle cx="50" cy="50" r="45" fill="url(#viralGrad)" stroke="#9f1239" stroke-width="3"/>
                    <circle cx="50" cy="50" r="38" fill="none" stroke="#fff" stroke-width="2" stroke-dasharray="5,3"/>
                    <path d="M 30 30 L 50 20 L 70 30 M 70 50 L 80 50 L 70 70 M 50 80 L 50 90 L 30 70 M 20 50 L 10 50 L 30 30" stroke="#fff" stroke-width="3" fill="none"/>
                    <circle cx="50" cy="50" r="15" fill="#fff"/>
                    <text x="50" y="58" font-size="14" font-weight="bold" fill="#ec4899" text-anchor="middle">‚ö°</text>
                </svg>`,
                required: 50, 
                type: 'shares',
                tier: 'epic'
            }
        ];

        // Estado global
        let userData = JSON.parse(localStorage.getItem('userData')) || {
            donations: 0,
            shares: 0,
            totalDonated: 0,
            name: '',
            email: '',
            emailVerified: false,
            avatar: {
                style: 'circle',
                bgColor: COLORS.backgrounds[0],
                accentColor: COLORS.accents[0]
            },
            showInRanking: true,
            unlockedAchievements: [],
            firstDonationDate: null
        };

        let selectedAvatar = {
            style: userData.avatar?.style || 'circle',
            bgColor: userData.avatar?.bgColor || COLORS.backgrounds[0],
            accentColor: userData.avatar?.accentColor || COLORS.accents[0]
        };

        // Inicializar la aplicaci√≥n
        function init() {
            // Migrar datos antiguos si es necesario
            migrateOldData();
            
            renderCurrencySelector();
            renderAvatarCustomizer();
            loadData();
            updateUI();
            attachEventListeners();
            
            // ========== ESCUCHAR CAMBIOS EN TIEMPO REAL ==========
            donationsRef.orderBy('timestamp', 'desc').limit(1).onSnapshot((snapshot) => {
                snapshot.docChanges().forEach((change) => {
                    if (change.type === 'added') {
                        console.log('üî• New donation detected! Reloading data...');
                        // Recargar datos cuando hay una nueva donaci√≥n
                        setTimeout(() => {
                            loadData();
                        }, 500);
                    }
                });
            }, (error) => {
                console.error('Error listening to Firebase changes:', error);
            });
            // ====================================================
        }

        // Renderizar selector de moneda
        function renderCurrencySelector() {
            const currencyGrid = document.getElementById('currencyGrid');
            if (!currencyGrid) return;
            
            currencyGrid.innerHTML = CURRENCIES.map(currency => `
                <div class="currency-option ${currency.code === selectedCurrency.code ? 'selected' : ''}"
                     onclick="selectCurrency('${currency.code}')">
                    <div class="currency-flag">${currency.flag}</div>
                    <div class="currency-code">${currency.code}</div>
                    <div class="currency-amount">${currency.symbol}${currency.amount.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</div>
                    <div class="currency-name">${currency.name}</div>
                </div>
            `).join('');
            
            updateCurrencyDisplay();
        }

        // Seleccionar moneda
        window.selectCurrency = function(code) {
            selectedCurrency = CURRENCIES.find(c => c.code === code) || CURRENCIES[0];
            renderCurrencySelector();
        }

        // Actualizar display de moneda seleccionada
        function updateCurrencyDisplay() {
            const symbolEl = document.getElementById('selectedCurrencySymbol');
            const amountEl = document.getElementById('selectedCurrencyAmount');
            
            if (symbolEl && amountEl) {
                symbolEl.textContent = selectedCurrency.symbol;
                amountEl.textContent = selectedCurrency.amount.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
            }
            
            // Actualizar texto del bot√≥n
            const btnDonation = document.getElementById('btnProcessDonation');
            if (btnDonation && userData.donations === 0) {
                btnDonation.textContent = `Confirmar Donaci√≥n ${selectedCurrency.symbol}${selectedCurrency.amount.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
            }
        }

        // Migrar datos antiguos para asegurar compatibilidad
        function migrateOldData() {
            const allDonations = JSON.parse(localStorage.getItem('allDonations')) || [];
            
            // Si no hay donaciones locales, salir temprano
            if (allDonations.length === 0) {
                return;
            }
            
            // Si hay donaciones y userData existe, sincronizar logros
            if (userData.email) {
                let needsUpdate = false;
                
                allDonations.forEach(donation => {
                    // Si la donaci√≥n es del usuario actual
                    if ((userData.email && donation.email === userData.email) || 
                        (!userData.email && donation.name === userData.name)) {
                        
                        // Si no tiene la lista completa de logros actuales, actualizarla
                        if (!donation.achievements || 
                            JSON.stringify(donation.achievements) !== JSON.stringify(userData.unlockedAchievements)) {
                            donation.achievements = [...userData.unlockedAchievements];
                            needsUpdate = true;
                        }
                        
                        // Si no tiene avatar o tiene formato antiguo, actualizarlo
                        if (!donation.avatar || !donation.avatar.style) {
                            donation.avatar = userData.avatar || {
                                style: 'circle',
                                bgColor: COLORS.backgrounds[0],
                                accentColor: COLORS.accents[0]
                            };
                            needsUpdate = true;
                        }
                    }
                });
                
                if (needsUpdate) {
                    localStorage.setItem('allDonations', JSON.stringify(allDonations));
                    console.log('‚úÖ Datos migrados exitosamente');
                }
            }
            
            // Verificar si hay donaciones locales que no est√°n en Firebase
            checkForUnsyncedDonations();
        }

        // Verificar donaciones no sincronizadas
        async function checkForUnsyncedDonations() {
            const localDonations = JSON.parse(localStorage.getItem('allDonations')) || [];
            
            if (localDonations.length === 0) return;
            
            try {
                const snapshot = await donationsRef.get();
                const firebaseDonationsCount = snapshot.size;
                
                if (localDonations.length > firebaseDonationsCount) {
                    console.log('‚ö†Ô∏è Found', localDonations.length - firebaseDonationsCount, 'unsynced donations');
                    showMigrationButton(localDonations.length - firebaseDonationsCount);
                }
            } catch (error) {
                console.error('Error checking unsynced donations:', error);
            }
        }

        // Mostrar bot√≥n de migraci√≥n
        function showMigrationButton(unsyncedCount) {
            const container = document.querySelector('.container');
            const existingButton = document.getElementById('migrationAlert');
            
            if (existingButton) return; // Ya existe
            
            const alertDiv = document.createElement('div');
            alertDiv.id = 'migrationAlert';
            alertDiv.style.cssText = `
                background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
                border: 2px solid #f59e0b;
                border-radius: 15px;
                padding: 20px;
                margin-bottom: 20px;
                text-align: center;
            `;
            
            alertDiv.innerHTML = `
                <div style="font-size: 1.2em; font-weight: bold; color: #92400e; margin-bottom: 10px;">
                    ‚ö†Ô∏è You have ${unsyncedCount} donation${unsyncedCount > 1 ? 's' : ''} not synced to the cloud
                </div>
                <div style="color: #78350f; margin-bottom: 15px;">
                    These donations are only on your device. Upload them to Firebase so everyone can see them!
                </div>
                <button id="btnMigrateToFirebase" style="
                    background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
                    color: white;
                    border: none;
                    padding: 12px 30px;
                    border-radius: 10px;
                    font-size: 1em;
                    font-weight: 600;
                    cursor: pointer;
                    box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
                    transition: transform 0.2s;
                ">
                    üöÄ Upload ${unsyncedCount} Donation${unsyncedCount > 1 ? 's' : ''} to Cloud
                </button>
                <button id="btnClearLocal" style="
                    background: #6b7280;
                    color: white;
                    border: none;
                    padding: 10px 20px;
                    border-radius: 10px;
                    font-size: 0.9em;
                    cursor: pointer;
                    margin-left: 10px;
                ">
                    Clear Local Data
                </button>
            `;
            
            container.insertBefore(alertDiv, container.firstChild);
            
            // Event listeners
            document.getElementById('btnMigrateToFirebase').addEventListener('click', migrateLocalDonationsToFirebase);
            document.getElementById('btnClearLocal').addEventListener('click', clearLocalDonations);
        }

        // Migrar donaciones locales a Firebase
        async function migrateLocalDonationsToFirebase() {
            const btn = document.getElementById('btnMigrateToFirebase');
            btn.disabled = true;
            btn.textContent = '‚è≥ Uploading...';
            
            const localDonations = JSON.parse(localStorage.getItem('allDonations')) || [];
            
            if (localDonations.length === 0) {
                showMessage('No local donations to upload');
                return;
            }
            
            let uploadedCount = 0;
            let errorCount = 0;
            
            // Subir donaciones una por una
            for (const donation of localDonations) {
                try {
                    // Verificar si ya existe (por fecha y email/nombre)
                    const existingQuery = await donationsRef
                        .where('date', '==', donation.date)
                        .where('email', '==', donation.email || '')
                        .get();
                    
                    if (existingQuery.empty) {
                        // No existe, subirla
                        await donationsRef.add({
                            ...donation,
                            timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                            migratedFrom: 'localStorage'
                        });
                        uploadedCount++;
                        console.log('‚úÖ Uploaded donation:', donation.name, donation.date);
                    } else {
                        console.log('‚è≠Ô∏è Skipping duplicate:', donation.name, donation.date);
                    }
                } catch (error) {
                    console.error('‚ùå Error uploading donation:', error);
                    errorCount++;
                }
            }
            
            // Mostrar resultado
            const alertDiv = document.getElementById('migrationAlert');
            if (uploadedCount > 0) {
                showMessage(`‚úÖ Successfully uploaded ${uploadedCount} donation${uploadedCount > 1 ? 's' : ''} to the cloud!`);
                
                // Opcional: limpiar localStorage despu√©s de migrar
                if (confirm('Donations uploaded successfully! Clear local storage to avoid duplicates?')) {
                    localStorage.removeItem('allDonations');
                }
                
                // Remover alerta
                if (alertDiv) alertDiv.remove();
                
                // Recargar datos
                setTimeout(() => {
                    loadData();
                }, 1000);
            } else {
                showMessage('All donations were already in the cloud!');
                if (alertDiv) alertDiv.remove();
            }
            
            if (errorCount > 0) {
                showMessage(`‚ö†Ô∏è ${errorCount} donation${errorCount > 1 ? 's' : ''} failed to upload`);
            }
        }

        // Limpiar donaciones locales
        function clearLocalDonations() {
            const localDonations = JSON.parse(localStorage.getItem('allDonations')) || [];
            
            if (localDonations.length === 0) {
                showMessage('No local donations to clear');
                const alertDiv = document.getElementById('migrationAlert');
                if (alertDiv) alertDiv.remove();
                return;
            }
            
            if (confirm(`‚ö†Ô∏è This will delete ${localDonations.length} local donation${localDonations.length > 1 ? 's' : ''} from your device.\n\nMake sure you uploaded them to Firebase first!\n\nAre you sure?`)) {
                localStorage.removeItem('allDonations');
                showMessage(`üóëÔ∏è Cleared ${localDonations.length} local donation${localDonations.length > 1 ? 's' : ''}`);
                
                const alertDiv = document.getElementById('migrationAlert');
                if (alertDiv) alertDiv.remove();
                
                // Recargar datos
                setTimeout(() => {
                    loadData();
                }, 500);
            }
        }

        // Generar avatar SVG
        function generateAvatarSVG(avatar) {
            const style = AVATAR_STYLES.find(s => s.id === avatar.style) || AVATAR_STYLES[0];
            return style.generate(avatar.bgColor, avatar.accentColor);
        }

        // Renderizar personalizador de avatar
        function renderAvatarCustomizer(isEditMode = false) {
            const suffix = isEditMode ? 'Edit' : '';
            
            // Preview
            updateAvatarPreview(isEditMode);
            
            // Colores de fondo
            const bgColorGrid = document.getElementById('bgColorGrid' + suffix);
            if (bgColorGrid) {
                bgColorGrid.innerHTML = COLORS.backgrounds.map(color => `
                    <div class="color-option ${color === selectedAvatar.bgColor ? 'selected' : ''}" 
                         style="background: ${color};"
                         onclick="selectBgColor('${color}', ${isEditMode})"></div>
                `).join('');
            }
            
            // Colores de acento
            const accentColorGrid = document.getElementById('accentColorGrid' + suffix);
            if (accentColorGrid) {
                accentColorGrid.innerHTML = COLORS.accents.map(color => `
                    <div class="color-option ${color === selectedAvatar.accentColor ? 'selected' : ''}" 
                         style="background: ${color};"
                         onclick="selectAccentColor('${color}', ${isEditMode})"></div>
                `).join('');
            }
            
            // Estilos de avatar
            const styleSelector = document.getElementById('avatarStyleSelector' + suffix);
            if (styleSelector) {
                styleSelector.innerHTML = AVATAR_STYLES.map(style => `
                    <div class="avatar-option ${style.id === selectedAvatar.style ? 'selected' : ''}"
                         title="${style.name}"
                         onclick="selectAvatarStyle('${style.id}', ${isEditMode})">
                        ${style.generate(selectedAvatar.bgColor, selectedAvatar.accentColor)}
                    </div>
                `).join('');
            }
        }

        // Actualizar preview del avatar
        function updateAvatarPreview(isEditMode = false) {
            const suffix = isEditMode ? 'Edit' : '';
            const preview = document.getElementById('avatarPreview' + suffix);
            if (preview) {
                preview.innerHTML = generateAvatarSVG(selectedAvatar);
            }
        }

        // Seleccionar color de fondo
        window.selectBgColor = function(color, isEditMode = false) {
            selectedAvatar.bgColor = color;
            renderAvatarCustomizer(isEditMode);
        }

        // Seleccionar color de acento
        window.selectAccentColor = function(color, isEditMode = false) {
            selectedAvatar.accentColor = color;
            renderAvatarCustomizer(isEditMode);
        }

        // Seleccionar estilo de avatar
        window.selectAvatarStyle = function(styleId, isEditMode = false) {
            selectedAvatar.style = styleId;
            renderAvatarCustomizer(isEditMode);
        }

        // Cargar datos
        function loadData() {
            // ========== CARGAR SOLO DESDE FIREBASE ==========
            donationsRef.orderBy('timestamp', 'desc').limit(1000).get()
                .then((snapshot) => {
                    const allDonations = [];
                    snapshot.forEach(doc => {
                        const data = doc.data();
                        allDonations.push({
                            id: doc.id,
                            ...data,
                            date: data.date || (data.timestamp ? new Date(data.timestamp.toDate()).toISOString() : new Date().toISOString())
                        });
                    });
                    
                    console.log('üìä Loaded from Firebase:', allDonations.length, 'donations');
                    
                    const totalAmount = allDonations.length;
                    
                    document.getElementById('counter').textContent = totalAmount + ' ‚Ç¨';
                    document.getElementById('donorCount').textContent = totalAmount + ' donations made';
                    
                    // Calcular donaciones de hoy
                    const todayDonations = allDonations.filter(d => isToday(new Date(d.date)));
                    document.getElementById('todayCount').textContent = todayDonations.length;
                    document.getElementById('todayDonations').textContent = todayDonations.length;
                    
                    // Calcular donaciones de esta semana
                    const weekDonations = allDonations.filter(d => isThisWeek(new Date(d.date)));
                    document.getElementById('thisWeek').textContent = weekDonations.length;
                    
                    // Calcular promedio por hora
                    if (allDonations.length > 0) {
                        const oldestDonation = allDonations.reduce((oldest, d) => {
                            const dDate = new Date(d.date);
                            return dDate < new Date(oldest.date) ? d : oldest;
                        });
                        const hoursActive = Math.max(1, Math.floor((Date.now() - new Date(oldestDonation.date).getTime()) / (1000 * 60 * 60)));
                        document.getElementById('avgPerHour').textContent = Math.round(totalAmount / hoursActive);
                    }
                    
                    // Calcular d√≠as activos
                    if (allDonations.length > 0) {
                        const oldestDonation = allDonations.reduce((oldest, d) => {
                            const dDate = new Date(d.date);
                            return dDate < new Date(oldest.date) ? d : oldest;
                        });
                        const daysActive = Math.max(1, Math.ceil((Date.now() - new Date(oldestDonation.date).getTime()) / (1000 * 60 * 60 * 24)));
                        document.getElementById('daysActive').textContent = daysActive;
                    }
                    
                    // Actualizar estad√≠sticas de progreso
                    updateProgressStats(totalAmount);
                    
                    // Actualizar ranking con datos de Firebase
                    updateRankingWithData(allDonations);
                })
                .catch((error) => {
                    console.error('‚ùå Error loading from Firebase:', error);
                    showMessage('‚ö†Ô∏è Error loading donations. Please refresh the page.');
                    
                    // Mostrar UI vac√≠a en caso de error
                    document.getElementById('counter').textContent = '0 ‚Ç¨';
                    document.getElementById('donorCount').textContent = '0 donations made';
                    document.getElementById('todayCount').textContent = '0';
                    document.getElementById('todayDonations').textContent = '0';
                    document.getElementById('thisWeek').textContent = '0';
                    document.getElementById('avgPerHour').textContent = '0';
                    updateProgressStats(0);
                });
            // ================================================
        }

        // Verificar si es hoy
        function isToday(date) {
            const today = new Date();
            return today.toDateString() === date.toDateString();
        }

        // Verificar si es esta semana
        function isThisWeek(date) {
            const today = new Date();
            const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
            return date >= weekAgo && date <= today;
        }

        // Actualizar estad√≠sticas de progreso
        function updateProgressStats(total) {
            const percentage = Math.min((total / GOAL) * 100, 100);
            const remaining = Math.max(GOAL - total, 0);
            
            document.getElementById('currentDonors').textContent = total.toLocaleString();
            document.getElementById('remaining').textContent = remaining.toLocaleString();
            document.getElementById('percentage').textContent = percentage.toFixed(1) + '%';
            
            const progressBar = document.getElementById('progressBar');
            progressBar.style.width = percentage + '%';
            progressBar.textContent = percentage.toFixed(1) + '%';
            
            // Actualizar siguiente hito
            updateNextMilestone(total);
        }

        // Actualizar siguiente hito
        function updateNextMilestone(total) {
            const milestones = [100, 500, 1000, 5000, 10000, 25000, 50000, 100000, 250000, 500000, 750000, 1000000];
            const nextMilestone = milestones.find(m => m > total);
            
            if (nextMilestone) {
                const remaining = nextMilestone - total;
                document.getElementById('nextMilestone').innerHTML = `
                    <div class="next-milestone-title">Next milestone:</div>
                    <div>${nextMilestone.toLocaleString()} donations (${remaining.toLocaleString()} remaining)</div>
                `;
            } else {
                document.getElementById('nextMilestone').innerHTML = `
                    <div class="next-milestone-title">GOAL REACHED!</div>
                    <div>üéâ We've reached one million donations!</div>
                `;
            }
        }

        // Actualizar UI
        function updateUI() {
            loadData(); // loadData ya actualiza el ranking, no hace falta m√°s
        }

        // Actualizar ranking con datos proporcionados
        function updateRankingWithData(allDonations) {
            const rankingList = document.getElementById('rankingListTop5');
            
            if (allDonations.length === 0) {
                rankingList.innerHTML = '<p style="text-align: center; color: #64748b;">No donations yet. Be the first!</p>';
                return;
            }
            
            const ranking = getRankingDataFromDonations(allDonations);
            
            rankingList.innerHTML = ranking.slice(0, 5).map((donor, index) => {
                return renderRankingItem(donor, index, false);
            }).join('');
        }

        // Obtener ranking desde array de donaciones
        function getRankingDataFromDonations(allDonations) {
            // Agrupar donaciones por email/nombre
            const donorMap = new Map();
            allDonations.forEach(donation => {
                const key = donation.email || donation.name || 'Anonymous-' + Math.random();
                if (!donorMap.has(key)) {
                    donorMap.set(key, {
                        name: donation.name || 'Anonymous Donor',
                        email: donation.email,
                        emailVerified: donation.emailVerified || false,
                        avatar: donation.avatar,
                        donations: 0,
                        totalAmount: 0,
                        achievements: donation.achievements || [],
                        showInRanking: donation.showInRanking !== false // Por defecto true si no est√° definido
                    });
                }
                const donor = donorMap.get(key);
                donor.donations++;
                donor.totalAmount++;
                // Actualizar achievements si son m√°s recientes
                if (donation.achievements && donation.achievements.length > donor.achievements.length) {
                    donor.achievements = donation.achievements;
                }
                // Actualizar showInRanking (usar el m√°s reciente)
                if (donation.showInRanking !== undefined) {
                    donor.showInRanking = donation.showInRanking;
                }
                // Actualizar emailVerified si est√° verificado
                if (donation.emailVerified) {
                    donor.emailVerified = true;
                }
            });
            
            // Convertir a array, FILTRAR por showInRanking y ordenar
            return Array.from(donorMap.values())
                .filter(donor => donor.donations > 0 && donor.showInRanking !== false)
                .sort((a, b) => b.totalAmount - a.totalAmount);
        }

        // Renderizar item del ranking
        function renderRankingItem(donor, index, isUserHighlight) {
            const positionClass = index === 0 ? 'top1' : index === 1 ? 'top2' : index === 2 ? 'top3' : '';
            const positionText = index === 0 ? 'üëë #1' : index === 1 ? 'ü•à #2' : index === 2 ? 'ü•â #3' : `#${index + 1}`;
            const avatarSVG = generateAvatarSVG(donor.avatar);
            
            // Obtener logros m√°s recientes de cada categor√≠a
            const donorAchievements = donor.achievements || [];
            const donationAchievements = achievements.filter(a => a.type === 'donations' && donorAchievements.includes(a.id));
            const shareAchievements = achievements.filter(a => a.type === 'shares' && donorAchievements.includes(a.id));
            
            const latestDonationAchievement = donationAchievements.length > 0 ? donationAchievements[donationAchievements.length - 1] : null;
            const latestShareAchievement = shareAchievements.length > 0 ? shareAchievements[shareAchievements.length - 1] : null;
            
            const displayAchievements = [latestDonationAchievement, latestShareAchievement].filter(a => a !== null);
            
            return `
                <div class="ranking-item ${isUserHighlight ? 'user-highlight' : ''}">
                    <div class="ranking-position ${positionClass}">${positionText}</div>
                    <div class="ranking-avatar">${avatarSVG}</div>
                    <div class="ranking-info">
                        <div class="ranking-name">
                            ${donor.name}${isUserHighlight ? ' (You)' : ''}
                            ${donor.emailVerified ? '<span style="color: #10b981; font-size: 0.85em; margin-left: 5px;" title="Verified email">‚úì</span>' : ''}
                        </div>
                        <div class="ranking-stats">${donor.donations} donations</div>
                        ${displayAchievements.length > 0 ? `
                            <div class="ranking-achievements">
                                ${displayAchievements.map(ach => 
                                    `<div class="achievement-badge" title="${ach.name}">${ach.svg}</div>`
                                ).join('')}
                            </div>
                        ` : ''}
                    </div>
                    <div class="ranking-amount">${donor.totalAmount}‚Ç¨</div>
                </div>
            `;
        }

        // Mostrar ranking completo
        function showFullRanking() {
            // Obtener datos SOLO desde Firebase
            donationsRef.get().then((snapshot) => {
                const allDonations = [];
                snapshot.forEach(doc => {
                    const data = doc.data();
                    allDonations.push({
                        ...data,
                        date: data.date || (data.timestamp ? new Date(data.timestamp.toDate()).toISOString() : new Date().toISOString())
                    });
                });
                
                const ranking = getRankingDataFromDonations(allDonations);
                const userEmail = userData.email;
                const userKey = userData.email || userData.name;
                
                let userPosition = -1;
                if (userKey) {
                    userPosition = ranking.findIndex(d => 
                        (d.email && d.email === userEmail) || (d.name === userData.name && !userEmail)
                    );
                }
                
                const content = document.getElementById('fullRankingContent');
                
                if (ranking.length === 0) {
                    content.innerHTML = '<p style="text-align: center; color: #64748b; padding: 40px;">No donations yet.</p>';
                } else {
                    content.innerHTML = `
                        ${userPosition >= 0 ? `
                            <div style="background: #dbeafe; padding: 20px; border-radius: 15px; margin-bottom: 20px; text-align: center;">
                                <h3 style="color: #1e40af; margin-bottom: 10px;">Your Position</h3>
                                <div style="font-size: 2em; font-weight: bold; color: #1e3a8a;">#${userPosition + 1}</div>
                                <div style="color: #1e40af; margin-top: 5px;">of ${ranking.length} participants</div>
                            </div>
                        ` : ''}
                        
                        <div style="max-height: 60vh; overflow-y: auto;">
                            ${ranking.map((donor, index) => {
                                const isUser = userPosition === index;
                                return renderRankingItem(donor, index, isUser);
                            }).join('')}
                        </div>
                    `;
                }
                
                document.getElementById('fullRankingModal').classList.add('show');
            }).catch((error) => {
                console.error('Error loading ranking:', error);
                const content = document.getElementById('fullRankingContent');
                content.innerHTML = `
                    <p style="text-align: center; color: #f59e0b; padding: 20px;">
                        Unable to load ranking. Please refresh the page.
                    </p>
                `;
                document.getElementById('fullRankingModal').classList.add('show');
            });
        }

        // Procesar donaci√≥n
        function processDonation() {
            let name, email, showInRanking, saveAchievements;
            
            // Si el usuario ya existe, usar sus datos
            if (userData.donations > 0) {
                name = userData.name;
                email = userData.email;
                showInRanking = userData.showInRanking;
                saveAchievements = true;
                // Mantener el avatar actual del usuario
                selectedAvatar = {...userData.avatar};
            } else {
                // Primera donaci√≥n, obtener datos del formulario
                name = document.getElementById('donorName').value.trim() || 'Anonymous Donor';
                email = document.getElementById('donorEmail').value.trim();
                showInRanking = document.getElementById('showInRanking').checked;
                saveAchievements = document.getElementById('saveAchievements').checked;
            }
            
            // Actualizar datos del usuario
            userData.donations++;
            userData.totalDonated++;
            userData.name = name;
            userData.email = email;
            userData.avatar = {...selectedAvatar};
            userData.showInRanking = showInRanking;
            
            if (!userData.firstDonationDate) {
                userData.firstDonationDate = new Date().toISOString();
            }
            
            // Verificar logros desbloqueados
            const newAchievements = checkAchievements();
            
            // ========== GUARDAR SOLO EN FIREBASE (NO localStorage) ==========
            localStorage.setItem('userData', JSON.stringify(userData)); // Solo guardar userData
            
            const donationData = {
                name,
                email,
                emailVerified: userData.emailVerified || false,
                avatar: {...selectedAvatar},
                date: new Date().toISOString(),
                showInRanking,
                achievements: [...userData.unlockedAchievements],
                currency: {
                    code: selectedCurrency.code,
                    symbol: selectedCurrency.symbol,
                    amount: selectedCurrency.amount,
                    name: selectedCurrency.name
                },
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            donationsRef.add(donationData)
                .then((docRef) => {
                    console.log('‚úÖ Donation saved to Firebase with ID:', docRef.id);
                    
                    // Actualizar usuario en Firebase si tiene email
                    if (email) {
                        return usersRef.doc(email).set({
                            name: userData.name,
                            email: userData.email,
                            avatar: userData.avatar,
                            donations: userData.donations,
                            totalDonated: userData.totalDonated,
                            shares: userData.shares,
                            unlockedAchievements: userData.unlockedAchievements,
                            showInRanking: userData.showInRanking,
                            lastDonation: new Date().toISOString()
                        }, { merge: true });
                    }
                })
                .then(() => {
                    console.log('‚úÖ User data updated in Firebase');
                    
                    // Enviar email de verificaci√≥n si es primera donaci√≥n con email
                    if (email && !userData.emailVerified && userData.donations === 1) {
                        sendVerificationEmail(email, name);
                    }
                })
                .catch((error) => {
                    console.error('‚ùå Error saving to Firebase:', error);
                    showMessage('‚ö†Ô∏è Error saving donation. Please try again.');
                });
            // ================================================================
            
            // Cerrar modal
            closeModal('donateModal');
            
            // Mostrar mensaje con la moneda
            showMessage(`Thank you for your donation of ${selectedCurrency.symbol}${selectedCurrency.amount.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}! üéâ`);
            
            // Actualizar UI
            updateUI();
            
            // Mostrar logros desbloqueados
            if (newAchievements.length > 0) {
                setTimeout(() => {
                    showAchievementNotification(newAchievements);
                }, 500);
            }
        }

        // Enviar email de verificaci√≥n
        async function sendVerificationEmail(email, displayName) {
            if (!email || verificationEmailSent) return;
            
            try {
                const actionCodeSettings = {
                    url: window.location.href,
                    handleCodeInApp: false
                };
                
                // Intentar crear usuario con contrase√±a temporal
                const tempPassword = 'TempPass!' + Math.random().toString(36).slice(2) + Date.now();
                
                try {
                    const userCredential = await auth.createUserWithEmailAndPassword(email, tempPassword);
                    console.log('‚úÖ User account created');
                    
                    // Actualizar displayName
                    if (displayName) {
                        await userCredential.user.updateProfile({ displayName: displayName });
                    }
                    
                    // Enviar email de verificaci√≥n
                    await userCredential.user.sendEmailVerification(actionCodeSettings);
                    verificationEmailSent = true;
                    
                    // IMPORTANTE: Cerrar sesi√≥n inmediatamente para que no se marque como verificado
                    await auth.signOut();
                    
                    showMessage(`üìß Verification email sent to ${email}. Check your inbox!`);
                    console.log('üìß Verification email sent, user signed out');
                    
                } catch (error) {
                    if (error.code === 'auth/email-already-in-use') {
                        // Usuario ya existe, intentar enviar link de sign-in
                        console.log('üìß User exists, sending sign-in link');
                        await auth.sendSignInLinkToEmail(email, actionCodeSettings);
                        window.localStorage.setItem('emailForSignIn', email);
                        verificationEmailSent = true;
                        showMessage(`üìß Verification link sent to ${email}!`);
                    } else {
                        throw error;
                    }
                }
                
            } catch (error) {
                console.error('‚ùå Error sending verification email:', error);
                showMessage('‚ö†Ô∏è Could not send verification email. You can still donate!');
            }
        }
        
        // Verificar si el usuario viene de un link de verificaci√≥n
        if (auth.isSignInWithEmailLink(window.location.href)) {
            let email = window.localStorage.getItem('emailForSignIn');
            if (!email) {
                email = window.prompt('Please provide your email for confirmation');
            }
            
            if (email) {
                auth.signInWithEmailLink(email, window.location.href)
                    .then((result) => {
                        window.localStorage.removeItem('emailForSignIn');
                        showMessage('‚úÖ Email verified successfully!');
                        
                        // Actualizar userData
                        if (userData.email === email) {
                            userData.emailVerified = true;
                            localStorage.setItem('userData', JSON.stringify(userData));
                        }
                        
                        // Limpiar URL
                        window.history.replaceState({}, document.title, window.location.pathname);
                    })
                    .catch((error) => {
                        console.error('Error verifying email:', error);
                        showMessage('‚ö†Ô∏è Error verifying email. Please try again.');
                    });
            }
        }

        // Verificar logros
        function checkAchievements() {
            const newAchievements = [];
            
            achievements.forEach(achievement => {
                if (!userData.unlockedAchievements.includes(achievement.id)) {
                    const value = achievement.type === 'donations' ? userData.donations : userData.shares;
                    if (value >= achievement.required) {
                        userData.unlockedAchievements.push(achievement.id);
                        newAchievements.push(achievement);
                    }
                }
            });
            
            // Si hay nuevos logros, actualizar todas las donaciones del usuario
            if (newAchievements.length > 0) {
                const allDonations = JSON.parse(localStorage.getItem('allDonations')) || [];
                allDonations.forEach(donation => {
                    // Identificar donaciones del usuario actual
                    if ((userData.email && donation.email === userData.email) || 
                        (!userData.email && donation.name === userData.name)) {
                        donation.achievements = [...userData.unlockedAchievements];
                    }
                });
                localStorage.setItem('allDonations', JSON.stringify(allDonations));
            }
            
            return newAchievements;
        }

        // Mostrar notificaci√≥n de logro
        function showAchievementNotification(achievements) {
            achievements.forEach((achievement, index) => {
                setTimeout(() => {
                    showMessage(`¬°Logro desbloqueado! ${achievement.name}: ${achievement.desc}`);
                }, index * 2000);
            });
        }

        // Mostrar mensaje
        function showMessage(text) {
            const message = document.getElementById('message');
            message.textContent = text;
            message.classList.add('show');
            
            setTimeout(() => {
                message.classList.remove('show');
            }, 3000);
        }

        // Abrir modal de donaci√≥n
        function openDonateModal() {
            const modal = document.getElementById('donateModal');
            const donationForm = document.getElementById('donationForm');
            
            // Renderizar selector de moneda
            renderCurrencySelector();
            
            // Si el usuario ya ha donado antes, ocultar el formulario
            if (userData.donations > 0) {
                donationForm.style.display = 'none';
                document.querySelector('#donateModal .modal-title').textContent = '¬°Welcome back! üéâ';
                
                // Cambiar texto del bot√≥n
                const btn = document.getElementById('btnProcessDonation');
                btn.textContent = `Confirm Donation ${selectedCurrency.symbol}${selectedCurrency.amount.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})} (as ${userData.name || 'Anonymous Donor'})`;
            } else {
                donationForm.style.display = 'block';
                document.querySelector('#donateModal .modal-title').textContent = 'Donate the equivalent of ‚Ç¨1';
                
                // Rellenar datos si existen
                if (userData.name) {
                    document.getElementById('donorName').value = userData.name;
                }
                if (userData.email) {
                    document.getElementById('donorEmail').value = userData.email;
                }
                
                selectedAvatar = userData.avatar ? {...userData.avatar} : {
                    style: 'circle',
                    bgColor: COLORS.backgrounds[0],
                    accentColor: COLORS.accents[0]
                };
                renderAvatarCustomizer(false);
                
                updateCurrencyDisplay();
            }
            
            modal.classList.add('show');
            
            // Mejorar UX del scroll
            setTimeout(() => {
                const modalContent = modal.querySelector('.modal-content');
                const scrollIndicator = document.getElementById('scrollIndicatorBtn');
                
                if (modalContent) {
                    // Resetear scroll al abrir
                    modalContent.scrollTop = 0;
                    modalContent.classList.remove('scrolled');
                    
                    // Verificar si hay scroll disponible
                    const checkScroll = () => {
                        const hasScroll = modalContent.scrollHeight > modalContent.clientHeight + 50;
                        
                        if (hasScroll && scrollIndicator) {
                            scrollIndicator.classList.add('visible');
                            
                            // Click en el bot√≥n indicador hace scroll suave
                            scrollIndicator.onclick = () => {
                                const donationForm = document.getElementById('donationForm');
                                if (donationForm) {
                                    donationForm.scrollIntoView({ behavior: 'smooth', block: 'start' });
                                }
                            };
                        } else if (scrollIndicator) {
                            scrollIndicator.classList.remove('visible');
                        }
                    };
                    
                    checkScroll();
                    
                    // Listener de scroll para ocultar indicador
                    const handleScroll = () => {
                        const scrollPosition = modalContent.scrollTop;
                        const scrollHeight = modalContent.scrollHeight - modalContent.clientHeight;
                        
                        // Si ha scrolleado m√°s del 15%, ocultar todo
                        if (scrollPosition > Math.max(100, scrollHeight * 0.15)) {
                            modalContent.classList.add('scrolled');
                            if (scrollIndicator) {
                                scrollIndicator.classList.remove('visible');
                            }
                        } else {
                            modalContent.classList.remove('scrolled');
                            checkScroll();
                        }
                    };
                    
                    modalContent.addEventListener('scroll', handleScroll);
                    
                    // Peque√±o bounce visual al abrir para indicar scroll
                    if (modalContent.scrollHeight > modalContent.clientHeight + 50) {
                        setTimeout(() => {
                            modalContent.scrollTo({ top: 80, behavior: 'smooth' });
                            setTimeout(() => {
                                modalContent.scrollTo({ top: 0, behavior: 'smooth' });
                            }, 800);
                        }, 500);
                    }
                }
            }, 100);
        }

        // Abrir modal de edici√≥n de perfil
        function openEditProfileModal() {
            // Cargar datos actuales
            document.getElementById('editEmail').value = userData.email || '';
            document.getElementById('editName').value = userData.name || '';
            document.getElementById('editShowInRanking').checked = userData.showInRanking;
            
            // Cargar avatar actual
            selectedAvatar = userData.avatar ? {...userData.avatar} : {
                style: 'circle',
                bgColor: COLORS.backgrounds[0],
                accentColor: COLORS.accents[0]
            };
            
            renderAvatarCustomizer(true);
            document.getElementById('editProfileModal').classList.add('show');
        }

        // Guardar cambios del perfil
        function saveProfileChanges() {
            const newName = document.getElementById('editName').value.trim();
            const newEmail = document.getElementById('editEmail').value.trim();
            const newShowInRanking = document.getElementById('editShowInRanking').checked;
            
            // Actualizar userData
            const oldEmail = userData.email;
            const oldName = userData.name;
            
            userData.name = newName || 'Anonymous Donor';
            userData.email = newEmail;
            userData.showInRanking = newShowInRanking;
            userData.avatar = {...selectedAvatar};
            
            // Guardar en localStorage
            localStorage.setItem('userData', JSON.stringify(userData));
            
            // Actualizar todas las donaciones anteriores de este usuario
            const allDonations = JSON.parse(localStorage.getItem('allDonations')) || [];
            allDonations.forEach(donation => {
                // Identificar donaciones del usuario actual
                if ((oldEmail && donation.email === oldEmail) || 
                    (!oldEmail && donation.name === oldName)) {
                    donation.name = userData.name;
                    donation.email = userData.email;
                    donation.avatar = {...userData.avatar};
                    donation.showInRanking = userData.showInRanking;
                }
            });
            localStorage.setItem('allDonations', JSON.stringify(allDonations));
            
            // Cerrar modal y actualizar UI
            closeModal('editProfileModal');
            showMessage('‚úÖ Profile updated successfully');
            updateUI();
        }
        function openProfileModal() {
            const profileContent = document.getElementById('profileContent');
            
            if (userData.donations === 0) {
                profileContent.innerHTML = `
                    <p style="text-align: center; color: #64748b; padding: 40px 20px;">
                        You haven't made any donations yet.<br>
                        Make your first donation to start unlocking achievements!
                    </p>
                `;
            } else {
                const ranking = getRankingData();
                const userKey = userData.email || userData.name;
                const userPosition = ranking.findIndex(d => 
                    (d.email && d.email === userData.email) || (d.name === userData.name && !userData.email)
                );
                
                // Obtener logros m√°s recientes de cada categor√≠a
                const donationAchievements = achievements.filter(a => a.type === 'donations' && userData.unlockedAchievements.includes(a.id));
                const shareAchievements = achievements.filter(a => a.type === 'shares' && userData.unlockedAchievements.includes(a.id));
                
                const latestDonationAchievement = donationAchievements.length > 0 ? donationAchievements[donationAchievements.length - 1] : null;
                const latestShareAchievement = shareAchievements.length > 0 ? shareAchievements[shareAchievements.length - 1] : null;
                
                const avatarSVG = generateAvatarSVG(userData.avatar);
                profileContent.innerHTML = `
                    <div class="user-profile">
                        <div class="user-avatar-large">${avatarSVG}</div>
                        <div class="user-name">${userData.name || 'Anonymous Donor'}</div>
                        ${userData.email ? `<div class="user-email">${userData.email}</div>` : ''}
                        
                        ${userPosition >= 0 ? `
                            <div class="user-ranking-position">
                                üèÜ Ranking position: <strong>#${userPosition + 1}</strong> of ${ranking.length}
                            </div>
                        ` : ''}
                        
                        <div class="user-stats-grid">
                            <div class="user-stat-box">
                                <div class="user-stat-value">${userData.donations}</div>
                                <div class="user-stat-label">Donations</div>
                            </div>
                            <div class="user-stat-box">
                                <div class="user-stat-value">${userData.totalDonated}‚Ç¨</div>
                                <div class="user-stat-label">Total donated</div>
                            </div>
                            <div class="user-stat-box">
                                <div class="user-stat-value">${userData.shares}</div>
                                <div class="user-stat-label">Times shared</div>
                            </div>
                            <div class="user-stat-box">
                                <div class="user-stat-value">${userData.unlockedAchievements.length}</div>
                                <div class="user-stat-label">Achievements</div>
                            </div>
                        </div>
                        
                        <button class="submit-btn" id="btnEditProfileFromProfile" style="margin-top: 20px;">
                            ‚öôÔ∏è Edit My Profile
                        </button>
                        
                        <button class="submit-btn" id="btnSyncData" style="margin-top: 10px; background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);">
                            üîÑ Sync Data
                        </button>
                    </div>
                    
                    ${(latestDonationAchievement || latestShareAchievement) ? `
                        <div style="background: #f8fafc; padding: 20px; border-radius: 15px; margin-bottom: 20px;">
                            <h3 style="color: #1e40af; margin-bottom: 15px; font-size: 1.2em; text-align: center;">üèÖ Your Featured Achievements</h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                                ${latestDonationAchievement ? `
                                    <div style="background: linear-gradient(135deg, #fff7ed 0%, #fed7aa 100%); padding: 15px; border-radius: 10px; text-align: center;">
                                        <div style="width: 60px; height: 60px; margin: 0 auto 10px;">${latestDonationAchievement.svg}</div>
                                        <div style="font-weight: 600; color: #1e293b; margin-bottom: 5px;">${latestDonationAchievement.name}</div>
                                        <div style="color: #64748b; font-size: 0.9em;">${latestDonationAchievement.desc}</div>
                                    </div>
                                ` : ''}
                                ${latestShareAchievement ? `
                                    <div style="background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); padding: 15px; border-radius: 10px; text-align: center;">
                                        <div style="width: 60px; height: 60px; margin: 0 auto 10px;">${latestShareAchievement.svg}</div>
                                        <div style="font-weight: 600; color: #1e293b; margin-bottom: 5px;">${latestShareAchievement.name}</div>
                                        <div style="color: #64748b; font-size: 0.9em;">${latestShareAchievement.desc}</div>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    ` : ''}
                    
                    <div class="achievements-section">
                        <h3 class="achievements-title">All Achievements</h3>
                        ${achievements.map(achievement => {
                            const unlocked = userData.unlockedAchievements.includes(achievement.id);
                            const value = achievement.type === 'donations' ? userData.donations : userData.shares;
                            const progress = Math.min((value / achievement.required) * 100, 100);
                            
                            return `
                                <div class="achievement-item ${unlocked ? 'unlocked' : 'locked'}">
                                    <div class="achievement-icon">${achievement.svg}</div>
                                    <div class="achievement-info">
                                        <div class="achievement-name">${achievement.name}</div>
                                        <div class="achievement-desc">${achievement.desc}</div>
                                        ${!unlocked ? `
                                            <div class="achievement-progress">
                                                <div class="achievement-progress-bar" style="width: ${progress}%"></div>
                                            </div>
                                        ` : ''}
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
                
                // A√±adir event listener al bot√≥n de editar perfil
                setTimeout(() => {
                    const editBtn = document.getElementById('btnEditProfileFromProfile');
                    if (editBtn) {
                        editBtn.addEventListener('click', () => {
                            closeModal('profileModal');
                            openEditProfileModal();
                        });
                    }
                    
                    // A√±adir event listener al bot√≥n de sincronizar
                    const syncBtn = document.getElementById('btnSyncData');
                    if (syncBtn) {
                        syncBtn.addEventListener('click', () => {
                            syncUserData();
                        });
                    }
                }, 0);
            }
            
            document.getElementById('profileModal').classList.add('show');
        }

        // Sincronizar datos manualmente
        function syncUserData() {
            const allDonations = JSON.parse(localStorage.getItem('allDonations')) || [];
            let updatedCount = 0;
            
            allDonations.forEach(donation => {
                // Identificar donaciones del usuario actual
                if ((userData.email && donation.email === userData.email) || 
                    (!userData.email && donation.name === userData.name)) {
                    donation.achievements = [...userData.unlockedAchievements];
                    donation.avatar = {...userData.avatar};
                    donation.name = userData.name;
                    donation.showInRanking = userData.showInRanking;
                    updatedCount++;
                }
            });
            
            localStorage.setItem('allDonations', JSON.stringify(allDonations));
            
            // Cerrar modal y actualizar UI
            closeModal('profileModal');
            showMessage(`‚úÖ ${updatedCount} donations synced successfully`);
            updateUI();
            
            // Reabrir el perfil para ver los cambios
            setTimeout(() => {
                openProfileModal();
            }, 500);
        }

        // Cerrar modal
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }

        // Compartir en redes sociales
        function shareTwitter() {
            const text = `I just donated ‚Ç¨1 for the world record! We're at ${document.getElementById('counter').textContent}. Will you join the "Let's See How Far We Can Go" experiment?`;
            const url = window.location.href;
            window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`, '_blank');
            userData.shares++;
            localStorage.setItem('userData', JSON.stringify(userData));
            checkAchievements();
        }

        function shareFacebook() {
            const url = window.location.href;
            window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`, '_blank');
            userData.shares++;
            localStorage.setItem('userData', JSON.stringify(userData));
            checkAchievements();
        }

        function shareWhatsApp() {
            const text = `I just donated ‚Ç¨1 for the world record! We're at ${document.getElementById('counter').textContent}. Will you join? ${window.location.href}`;
            window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, '_blank');
            userData.shares++;
            localStorage.setItem('userData', JSON.stringify(userData));
            checkAchievements();
        }

        function copyLink() {
            navigator.clipboard.writeText(window.location.href).then(() => {
                showMessage('Link copied to clipboard!');
                userData.shares++;
                localStorage.setItem('userData', JSON.stringify(userData));
                checkAchievements();
            });
        }

        // Adjuntar event listeners
        function attachEventListeners() {
            // Botones principales
            document.getElementById('btnDonate').addEventListener('click', openDonateModal);
            document.getElementById('btnProfile').addEventListener('click', openProfileModal);
            document.getElementById('btnRanking').addEventListener('click', showFullRanking);
            document.getElementById('btnViewFullRanking').addEventListener('click', showFullRanking);
            
            // Botones del modal de donaci√≥n
            document.getElementById('closeDonate').addEventListener('click', () => closeModal('donateModal'));
            document.getElementById('btnProcessDonation').addEventListener('click', processDonation);
            
            // Botones del modal de edici√≥n de perfil
            document.getElementById('closeEditProfile').addEventListener('click', () => closeModal('editProfileModal'));
            document.getElementById('btnSaveProfile').addEventListener('click', saveProfileChanges);
            
            // Botones del modal de perfil
            document.getElementById('closeProfile').addEventListener('click', () => closeModal('profileModal'));
            
            // Botones del modal de ranking completo
            document.getElementById('closeFullRanking').addEventListener('click', () => closeModal('fullRankingModal'));
            
            // Botones de compartir
            document.getElementById('btnShareTwitter').addEventListener('click', shareTwitter);
            document.getElementById('btnShareFacebook').addEventListener('click', shareFacebook);
            document.getElementById('btnShareWhatsApp').addEventListener('click', shareWhatsApp);
            document.getElementById('btnCopyLink').addEventListener('click', copyLink);
            
            // Cerrar modales al hacer clic fuera
            window.addEventListener('click', (e) => {
                if (e.target.classList.contains('modal')) {
                    e.target.classList.remove('show');
                }
            });
        }

        // Inicializar cuando el DOM est√© listo
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
